(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["index"]=t():e["index"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="fae3")}({8875:function(e,t,r){var s,a,i;(function(r,n){a=[],s=n,i="function"===typeof s?s.apply(t,a):s,void 0===i||(e.exports=i)})("undefined"!==typeof self&&self,(function(){function e(){const t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var r,s,a,i=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,u=i.exec(m.stack)||n.exec(m.stack),o=u&&u[1]||!1,l=u&&u[2]||!1,c=document.location.href.replace(document.location.hash,""),h=document.getElementsByTagName("script");o===c&&(r=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),a=r.replace(s,"$1").trim());for(var d=0;d<h.length;d++){if("interactive"===h[d].readyState)return h[d];if(h[d].src===o)return h[d];if(o===c&&h[d].innerHTML&&h[d].innerHTML.trim()===a)return h[d]}return null}}return e}))},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"Model",(function(){return o})),r.d(t,"Validator",(function(){return u})),r.d(t,"BaseValidator",(function(){return c})),"undefined"!==typeof window){var s=window.document.currentScript,a=r("8875");s=a(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:a});var i=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(r.p=i[1])}class n{constructor(){this.validators={}}addValidator(e){if(!e.type)throw new Error("验证器必须有 type 属性");this.validators[e.type]=e}getValidators(e,t){return e.map(e=>{if(Array.isArray(e)&&e.length>=2)return this.createValidator(e,t);throw new Error("不支持的rules")})}validate(e,t,r){let s=this.getValidators(t,r),a={},i=s.map(t=>t.validateAttributes(e).then(e=>{e.forEach(([e,t])=>{void 0===a[e]&&(a[e]=[]),a[e].push(t)})}));return Promise.all(i).then(()=>{if(Object.keys(a).length)return Promise.reject(a)})}validateOne(e,t,r){}createValidator([e,t,r={}],s){const a=this.validators[e];if(!a)throw new Error("不支持的验证类型");return new a({...r,attributes:t,labels:s})}}var u=new n;Symbol("labels"),Symbol("rules");class o{constructor(e={}){this._validators=null,this.errors={},typeof e===typeof{}&&this.attributes.forEach(t=>{e.hasOwnProperty(t)?this[t]=e[t]:this[t]=null})}get labels(){return{}}get rules(){return[]}get attributes(){return[]}get form(){return this.attributes.reduce((e,t)=>(e[t]=this[t],e),{})}createValidators(){return this.rules.map(e=>{if(Array.isArray(e)&&e.length>=2)return u.createValidator(e,this.labels);throw new Error("不支持的rules")})}getValidators(){return null===this._validators&&(this._validators=this.createValidators()),this._validators}getAttributeLabel(e){return this.labels[e]||e}validate(e=null,t=!0){return u.validate(this.form,this.rules,this.labels)}addError(e,t=""){void 0==this.errors[e]&&(this.errors[e]=[]),this.errors[e].push(t)}clearErrors(e=null){this.errors=null===e?{}:Object.assign({},this.errors,{[e]:[]})}hasErrors(e=null){if(null===e)return Object.keys(this.errors).length;let t=this.errors[e];return void 0!=t&&t.length}get firstError(){if(this.hasErrors()){let e=Object.keys(this.errors)[0];return this.errors[e][0]}}}class l{constructor({attributes:e=[],labels:t={}}){this.parseAttributes(e),this.labels=t,this.message=null}parseAttributes(e){"string"===typeof e&&(e=e.split(",")),this.attributes=e}parse(e,t){for(var r in Object.assign(this,e),t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&(this[r]=t[r])}async validateAttributes(e,t=null){null==t?t=this.attributes:"string"===typeof t&&(t=[t]);let r=[],s=t.map(async t=>this.validateAttribute(e,t).catch(e=>{let s=this.formatMessage(e,{attribute:this.labels[t]||t,...this});r.push([t,s])}));return await Promise.all(s),r}validateAttribute(e,t){return new Promise((r,s)=>{let a=this.validateValue(e[t],r,s);void 0!==a&&(a?s(a):r())})}validateValue(e){throw new Error("这个类不支持验证")}formatMessage(e,t){return e.replace(/{(\w+)}/g,(e,r)=>t[r])}addError(e,t,r,s={}){s.attribute=e.getAttributeLabel(t),e.addError(t,this.formatMessage(r,s))}}var c=l;class h extends c{constructor(e){super(e),this.message="{attribute}不能为空"}validateValue(e){do{if(0===e)break;if(Array.isArray(e)&&e.length>0)break;if("boolean"===typeof e)break;if(e)break;return this.message}while(0);return null}}h.type="required";class d extends c{constructor(e){super(e);const t={message:"{attribute}必须是数字",max:1/0,message_max:"{attribute}不能大于{max}",min:-1/0,message_min:"{attribute}不能小于{min}"};this.parse(t,e)}validateValue(e){do{if("number"===typeof e){if(null!==this.max&&e>this.max)return this.message_max;if(null!==this.min&&e<this.min)return this.message_min;break}return this.message}while(0);return null}}d.type="number";class m extends c{constructor(e){super(e),this.message="{attribute}必须是时间"}validateValue(e){do{if(Date.parse(e))break;return this.message}while(0);return null}}m.type="date";class p extends c{constructor(e){super(e);const t={message:"{attribute}必须是11位数字的号码格式"};this.parse(t,e)}validateValue(e){do{if(/^1\d{10}$/.test(e))break;return this.message}while(0);return null}}p.type="phone";class f extends c{constructor(e){super(e);const t={message:"{attribute}必须是字符串",min:0,message_min:"{attribute}长度至少为{min}",max:1/0,message_max:"{attribute}长度不能超过{max}"};this.parse(t,e)}validateValue(e){do{if("string"===typeof e){if(this.min&&e.length<this.min)return this.message_min;if(this.max&&e.length>this.max)return this.message_max;break}return this.message}while(0);return null}}f.type="string";class g extends c{constructor(e){super(e);const t={message:"{attribute}必须是满足正则表达式{regexp}",regexp:null};this.parse(t,e),"string"===typeof e.regexp&&(this.regexp=new RegExp(e.regexp))}validateValue(e){do{if(this.regexp.test(e))break;return this.message}while(0);return null}}g.type="regexp";class b extends c{constructor(e){super(e);const t={message:"{attribute}没有通过验证",handle(e,t){t(this.message)}};this.parse(t,e)}validateValue(e,t,r){this.handle(t,()=>{r(this.message)},e)}}b.type="async";class y extends c{constructor(e){super(e);const t={message:"{attribute}必须是布尔型"};this.parse(t,e)}validateValue(e){return"boolean"===typeof e?null:this.message}}y.type="boolean";class x extends c{constructor(e){super(e);const t={message:"{attribute}必须是数组",max:null,message_max:"{attribute}最多{max}个",min:null,message_min:"{attribute}最少{min}个"};this.parse(t,e)}validateValue(e){do{if(Array.isArray(e)){if(null!==this.max&&e.length>this.max)return this.message_max;if(null!==this.min&&e.length<this.min)return this.message_min;break}return this.message}while(0);return null}}x.type="array";var v=[h,f,d,y,m,x,p,g,b];v.forEach(e=>{u.addValidator(e)})}})}));
//# sourceMappingURL=index.umd.min.js.map